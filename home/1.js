(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{"XI1+":function(t,e,n){"use strict";n.d(e,"a",function(){return wo});var o={value:()=>{}};function r(){for(var t,e=0,n=arguments.length,o={};e<n;++e){if(!(t=arguments[e]+"")||t in o||/[\s.]/.test(t))throw new Error("illegal type: "+t);o[t]=[]}return new i(o)}function i(t){this._=t}function s(t,e){return t.trim().split(/^|\s+/).map(function(t){var n="",o=t.indexOf(".");if(o>=0&&(n=t.slice(o+1),t=t.slice(0,o)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:n}})}function a(t,e){for(var n,o=0,r=t.length;o<r;++o)if((n=t[o]).name===e)return n.value}function c(t,e,n){for(var r=0,i=t.length;r<i;++r)if(t[r].name===e){t[r]=o,t=t.slice(0,r).concat(t.slice(r+1));break}return null!=n&&t.push({name:e,value:n}),t}i.prototype=r.prototype={constructor:i,on:function(t,e){var n,o=this._,r=s(t+"",o),i=-1,h=r.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++i<h;)if(n=(t=r[i]).type)o[n]=c(o[n],t.name,e);else if(null==e)for(n in o)o[n]=c(o[n],t.name,null);return this}for(;++i<h;)if((n=(t=r[i]).type)&&(n=a(o[n],t.name)))return n},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new i(t)},call:function(t,e){if((n=arguments.length-2)>0)for(var n,o,r=new Array(n),i=0;i<n;++i)r[i]=arguments[i+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(i=0,n=(o=this._[t]).length;i<n;++i)o[i].value.apply(e,r)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var o=this._[t],r=0,i=o.length;r<i;++r)o[r].value.apply(e,n)}};var h=r;function u(){}var l=function(t){return null==t?u:function(){return this.querySelector(t)}},d=function(t){return"object"==typeof t&&"length"in t?t:Array.from(t)};function f(){return[]}var p=function(t){return null==t?f:function(){return this.querySelectorAll(t)}},m=function(t){return function(){return this.matches(t)}};function g(t){return function(e){return e.matches(t)}}var y=Array.prototype.find;function v(){return this.firstElementChild}var w=Array.prototype.filter;function b(){return this.children}var _=function(t){return new Array(t.length)};function x(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}x.prototype={constructor:x,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};var N=function(t){return function(){return t}};function k(t,e,n,o,r,i){for(var s,a=0,c=e.length,h=i.length;a<h;++a)(s=e[a])?(s.__data__=i[a],o[a]=s):n[a]=new x(t,i[a]);for(;a<c;++a)(s=e[a])&&(r[a]=s)}function z(t,e,n,o,r,i,s){var a,c,h,u=new Map,l=e.length,d=i.length,f=new Array(l);for(a=0;a<l;++a)(c=e[a])&&(f[a]=h=s.call(c,c.__data__,a,e)+"",u.has(h)?r[a]=c:u.set(h,c));for(a=0;a<d;++a)h=s.call(t,i[a],a,i)+"",(c=u.get(h))?(o[a]=c,c.__data__=i[a],u.delete(h)):n[a]=new x(t,i[a]);for(a=0;a<l;++a)(c=e[a])&&u.get(f[a])===c&&(r[a]=c)}function T(t){return t.__data__}function M(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}var O="http://www.w3.org/1999/xhtml",A={svg:"http://www.w3.org/2000/svg",xhtml:O,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},S=function(t){var e=t+="",n=e.indexOf(":");return n>=0&&"xmlns"!==(e=t.slice(0,n))&&(t=t.slice(n+1)),A.hasOwnProperty(e)?{space:A[e],local:t}:t};function E(t){return function(){this.removeAttribute(t)}}function P(t){return function(){this.removeAttributeNS(t.space,t.local)}}function C(t,e){return function(){this.setAttribute(t,e)}}function R(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function D(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}}function j(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}var I=function(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView};function B(t){return function(){this.style.removeProperty(t)}}function L(t,e,n){return function(){this.style.setProperty(t,e,n)}}function q(t,e,n){return function(){var o=e.apply(this,arguments);null==o?this.style.removeProperty(t):this.style.setProperty(t,o,n)}}function X(t,e){return t.style.getPropertyValue(e)||I(t).getComputedStyle(t,null).getPropertyValue(e)}function H(t){return function(){delete this[t]}}function Y(t,e){return function(){this[t]=e}}function F(t,e){return function(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}}function U(t){return t.trim().split(/^|\s+/)}function V(t){return t.classList||new W(t)}function W(t){this._node=t,this._names=U(t.getAttribute("class")||"")}function K(t,e){for(var n=V(t),o=-1,r=e.length;++o<r;)n.add(e[o])}function J(t,e){for(var n=V(t),o=-1,r=e.length;++o<r;)n.remove(e[o])}function $(t){return function(){K(this,t)}}function Z(t){return function(){J(this,t)}}function G(t,e){return function(){(e.apply(this,arguments)?K:J)(this,t)}}function Q(){this.textContent=""}function tt(t){return function(){this.textContent=t}}function et(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}function nt(){this.innerHTML=""}function ot(t){return function(){this.innerHTML=t}}function rt(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}function it(){this.nextSibling&&this.parentNode.appendChild(this)}function st(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function at(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===O&&e.documentElement.namespaceURI===O?e.createElement(t):e.createElementNS(n,t)}}function ct(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}W.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};var ht=function(t){var e=S(t);return(e.local?ct:at)(e)};function ut(){return null}function lt(){var t=this.parentNode;t&&t.removeChild(this)}function dt(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function ft(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function pt(t){return t.trim().split(/^|\s+/).map(function(t){var e="",n=t.indexOf(".");return n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),{type:t,name:e}})}function mt(t){return function(){var e=this.__on;if(e){for(var n,o=0,r=-1,i=e.length;o<i;++o)n=e[o],t.type&&n.type!==t.type||n.name!==t.name?e[++r]=n:this.removeEventListener(n.type,n.listener,n.options);++r?e.length=r:delete this.__on}}}function gt(t,e,n){return function(){var o,r=this.__on,i=function(t){return function(e){t.call(this,e,this.__data__)}}(e);if(r)for(var s=0,a=r.length;s<a;++s)if((o=r[s]).type===t.type&&o.name===t.name)return this.removeEventListener(o.type,o.listener,o.options),this.addEventListener(o.type,o.listener=i,o.options=n),void(o.value=e);this.addEventListener(t.type,i,n),o={type:t.type,name:t.name,value:e,listener:i,options:n},r?r.push(o):this.__on=[o]}}function yt(t,e,n){var o=I(t),r=o.CustomEvent;"function"==typeof r?r=new r(e,n):(r=o.document.createEvent("Event"),n?(r.initEvent(e,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(e,!1,!1)),t.dispatchEvent(r)}function vt(t,e){return function(){return yt(this,t,e)}}function wt(t,e){return function(){return yt(this,t,e.apply(this,arguments))}}var bt=[null];function _t(t,e){this._groups=t,this._parents=e}function xt(){return new _t([[document.documentElement]],bt)}_t.prototype=xt.prototype={constructor:_t,select:function(t){"function"!=typeof t&&(t=l(t));for(var e=this._groups,n=e.length,o=new Array(n),r=0;r<n;++r)for(var i,s,a=e[r],c=a.length,h=o[r]=new Array(c),u=0;u<c;++u)(i=a[u])&&(s=t.call(i,i.__data__,u,a))&&("__data__"in i&&(s.__data__=i.__data__),h[u]=s);return new _t(o,this._parents)},selectAll:function(t){t="function"==typeof t?function(t){return function(){var e=t.apply(this,arguments);return null==e?[]:d(e)}}(t):p(t);for(var e=this._groups,n=e.length,o=[],r=[],i=0;i<n;++i)for(var s,a=e[i],c=a.length,h=0;h<c;++h)(s=a[h])&&(o.push(t.call(s,s.__data__,h,a)),r.push(s));return new _t(o,r)},selectChild:function(t){return this.select(null==t?v:function(t){return function(){return y.call(this.children,t)}}("function"==typeof t?t:g(t)))},selectChildren:function(t){return this.selectAll(null==t?b:function(t){return function(){return w.call(this.children,t)}}("function"==typeof t?t:g(t)))},filter:function(t){"function"!=typeof t&&(t=m(t));for(var e=this._groups,n=e.length,o=new Array(n),r=0;r<n;++r)for(var i,s=e[r],a=s.length,c=o[r]=[],h=0;h<a;++h)(i=s[h])&&t.call(i,i.__data__,h,s)&&c.push(i);return new _t(o,this._parents)},data:function(t,e){if(!arguments.length)return Array.from(this,T);var n=e?z:k,o=this._parents,r=this._groups;"function"!=typeof t&&(t=N(t));for(var i=r.length,s=new Array(i),a=new Array(i),c=new Array(i),h=0;h<i;++h){var u=o[h],l=r[h],f=l.length,p=d(t.call(u,u&&u.__data__,h,o)),m=p.length,g=a[h]=new Array(m),y=s[h]=new Array(m),v=c[h]=new Array(f);n(u,l,g,y,v,p,e);for(var w,b,_=0,x=0;_<m;++_)if(w=g[_]){for(_>=x&&(x=_+1);!(b=y[x])&&++x<m;);w._next=b||null}}return(s=new _t(s,o))._enter=a,s._exit=c,s},enter:function(){return new _t(this._enter||this._groups.map(_),this._parents)},exit:function(){return new _t(this._exit||this._groups.map(_),this._parents)},join:function(t,e,n){var o=this.enter(),r=this,i=this.exit();return o="function"==typeof t?t(o):o.append(t+""),null!=e&&(r=e(r)),null==n?i.remove():n(i),o&&r?o.merge(r).order():r},merge:function(t){if(!(t instanceof _t))throw new Error("invalid merge");for(var e=this._groups,n=t._groups,o=e.length,r=Math.min(o,n.length),i=new Array(o),s=0;s<r;++s)for(var a,c=e[s],h=n[s],u=c.length,l=i[s]=new Array(u),d=0;d<u;++d)(a=c[d]||h[d])&&(l[d]=a);for(;s<o;++s)i[s]=e[s];return new _t(i,this._parents)},selection:function(){return this},order:function(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var o,r=t[e],i=r.length-1,s=r[i];--i>=0;)(o=r[i])&&(s&&4^o.compareDocumentPosition(s)&&s.parentNode.insertBefore(o,s),s=o);return this},sort:function(t){function e(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}t||(t=M);for(var n=this._groups,o=n.length,r=new Array(o),i=0;i<o;++i){for(var s,a=n[i],c=a.length,h=r[i]=new Array(c),u=0;u<c;++u)(s=a[u])&&(h[u]=s);h.sort(e)}return new _t(r,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var o=t[e],r=0,i=o.length;r<i;++r){var s=o[r];if(s)return s}return null},size:function(){let t=0;for(const e of this)++t;return t},empty:function(){return!this.node()},each:function(t){for(var e=this._groups,n=0,o=e.length;n<o;++n)for(var r,i=e[n],s=0,a=i.length;s<a;++s)(r=i[s])&&t.call(r,r.__data__,s,i);return this},attr:function(t,e){var n=S(t);if(arguments.length<2){var o=this.node();return n.local?o.getAttributeNS(n.space,n.local):o.getAttribute(n)}return this.each((null==e?n.local?P:E:"function"==typeof e?n.local?j:D:n.local?R:C)(n,e))},style:function(t,e,n){return arguments.length>1?this.each((null==e?B:"function"==typeof e?q:L)(t,e,null==n?"":n)):X(this.node(),t)},property:function(t,e){return arguments.length>1?this.each((null==e?H:"function"==typeof e?F:Y)(t,e)):this.node()[t]},classed:function(t,e){var n=U(t+"");if(arguments.length<2){for(var o=V(this.node()),r=-1,i=n.length;++r<i;)if(!o.contains(n[r]))return!1;return!0}return this.each(("function"==typeof e?G:e?$:Z)(n,e))},text:function(t){return arguments.length?this.each(null==t?Q:("function"==typeof t?et:tt)(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?nt:("function"==typeof t?rt:ot)(t)):this.node().innerHTML},raise:function(){return this.each(it)},lower:function(){return this.each(st)},append:function(t){var e="function"==typeof t?t:ht(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})},insert:function(t,e){var n="function"==typeof t?t:ht(t),o=null==e?ut:"function"==typeof e?e:l(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),o.apply(this,arguments)||null)})},remove:function(){return this.each(lt)},clone:function(t){return this.select(t?ft:dt)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,e,n){var o,r,i=pt(t+""),s=i.length;if(!(arguments.length<2)){for(a=e?gt:mt,o=0;o<s;++o)this.each(a(i[o],e,n));return this}var a=this.node().__on;if(a)for(var c,h=0,u=a.length;h<u;++h)for(o=0,c=a[h];o<s;++o)if((r=i[o]).type===c.type&&r.name===c.name)return c.value},dispatch:function(t,e){return this.each(("function"==typeof e?wt:vt)(t,e))},[Symbol.iterator]:function*(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var o,r=t[e],i=0,s=r.length;i<s;++i)(o=r[i])&&(yield o)}};var Nt=xt,kt=function(t){return"string"==typeof t?new _t([[document.querySelector(t)]],[document.documentElement]):new _t([[t]],bt)};function zt(t){t.stopImmediatePropagation()}var Tt=function(t){t.preventDefault(),t.stopImmediatePropagation()},Mt=function(t){var e=t.document.documentElement,n=kt(t).on("dragstart.drag",Tt,!0);"onselectstart"in e?n.on("selectstart.drag",Tt,!0):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")};function Ot(t,e){var n=t.document.documentElement,o=kt(t).on("dragstart.drag",null);e&&(o.on("click.drag",Tt,!0),setTimeout(function(){o.on("click.drag",null)},0)),"onselectstart"in n?o.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}var At=function(t,e,n){t.prototype=e.prototype=n,n.constructor=t};function St(t,e){var n=Object.create(t.prototype);for(var o in e)n[o]=e[o];return n}function Et(){}var Pt=.7,Ct=1/Pt,Rt="\\s*([+-]?\\d+)\\s*",Dt="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",jt="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",It=/^#([0-9a-f]{3,8})$/,Bt=new RegExp("^rgb\\("+[Rt,Rt,Rt]+"\\)$"),Lt=new RegExp("^rgb\\("+[jt,jt,jt]+"\\)$"),qt=new RegExp("^rgba\\("+[Rt,Rt,Rt,Dt]+"\\)$"),Xt=new RegExp("^rgba\\("+[jt,jt,jt,Dt]+"\\)$"),Ht=new RegExp("^hsl\\("+[Dt,jt,jt]+"\\)$"),Yt=new RegExp("^hsla\\("+[Dt,jt,jt,Dt]+"\\)$"),Ft={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Ut(){return this.rgb().formatHex()}function Vt(){return this.rgb().formatRgb()}function Wt(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=It.exec(t))?(n=e[1].length,e=parseInt(e[1],16),6===n?Kt(e):3===n?new Gt(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===n?Jt(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===n?Jt(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=Bt.exec(t))?new Gt(e[1],e[2],e[3],1):(e=Lt.exec(t))?new Gt(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=qt.exec(t))?Jt(e[1],e[2],e[3],e[4]):(e=Xt.exec(t))?Jt(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=Ht.exec(t))?ne(e[1],e[2]/100,e[3]/100,1):(e=Yt.exec(t))?ne(e[1],e[2]/100,e[3]/100,e[4]):Ft.hasOwnProperty(t)?Kt(Ft[t]):"transparent"===t?new Gt(NaN,NaN,NaN,0):null}function Kt(t){return new Gt(t>>16&255,t>>8&255,255&t,1)}function Jt(t,e,n,o){return o<=0&&(t=e=n=NaN),new Gt(t,e,n,o)}function $t(t){return t instanceof Et||(t=Wt(t)),t?new Gt((t=t.rgb()).r,t.g,t.b,t.opacity):new Gt}function Zt(t,e,n,o){return 1===arguments.length?$t(t):new Gt(t,e,n,null==o?1:o)}function Gt(t,e,n,o){this.r=+t,this.g=+e,this.b=+n,this.opacity=+o}function Qt(){return"#"+ee(this.r)+ee(this.g)+ee(this.b)}function te(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===t?")":", "+t+")")}function ee(t){return((t=Math.max(0,Math.min(255,Math.round(t)||0)))<16?"0":"")+t.toString(16)}function ne(t,e,n,o){return o<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new re(t,e,n,o)}function oe(t){if(t instanceof re)return new re(t.h,t.s,t.l,t.opacity);if(t instanceof Et||(t=Wt(t)),!t)return new re;if(t instanceof re)return t;var e=(t=t.rgb()).r/255,n=t.g/255,o=t.b/255,r=Math.min(e,n,o),i=Math.max(e,n,o),s=NaN,a=i-r,c=(i+r)/2;return a?(s=e===i?(n-o)/a+6*(n<o):n===i?(o-e)/a+2:(e-n)/a+4,a/=c<.5?i+r:2-i-r,s*=60):a=c>0&&c<1?0:s,new re(s,a,c,t.opacity)}function re(t,e,n,o){this.h=+t,this.s=+e,this.l=+n,this.opacity=+o}function ie(t,e,n){return 255*(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)}function se(t,e,n,o,r){var i=t*t,s=i*t;return((1-3*t+3*i-s)*e+(4-6*i+3*s)*n+(1+3*t+3*i-3*s)*o+s*r)/6}At(Et,Wt,{copy:function(t){return Object.assign(new this.constructor,this,t)},displayable:function(){return this.rgb().displayable()},hex:Ut,formatHex:Ut,formatHsl:function(){return oe(this).formatHsl()},formatRgb:Vt,toString:Vt}),At(Gt,Zt,St(Et,{brighter:function(t){return t=null==t?Ct:Math.pow(Ct,t),new Gt(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=null==t?Pt:Math.pow(Pt,t),new Gt(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Qt,formatHex:Qt,formatRgb:te,toString:te})),At(re,function(t,e,n,o){return 1===arguments.length?oe(t):new re(t,e,n,null==o?1:o)},St(Et,{brighter:function(t){return t=null==t?Ct:Math.pow(Ct,t),new re(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?Pt:Math.pow(Pt,t),new re(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,o=n+(n<.5?n:1-n)*e,r=2*n-o;return new Gt(ie(t>=240?t-240:t+120,r,o),ie(t,r,o),ie(t<120?t+240:t-120,r,o),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===t?")":", "+t+")")}}));var ae=t=>()=>t;function ce(t,e){var n=e-t;return n?function(t,e){return function(n){return t+n*e}}(t,n):ae(isNaN(t)?e:t)}var he=function t(e){var n=function(t){return 1==(t=+t)?ce:function(e,n){return n-e?function(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(o){return Math.pow(t+o*e,n)}}(e,n,t):ae(isNaN(e)?n:e)}}(e);function o(t,e){var o=n((t=Zt(t)).r,(e=Zt(e)).r),r=n(t.g,e.g),i=n(t.b,e.b),s=ce(t.opacity,e.opacity);return function(e){return t.r=o(e),t.g=r(e),t.b=i(e),t.opacity=s(e),t+""}}return o.gamma=t,o}(1);function ue(t){return function(e){var n,o,r=e.length,i=new Array(r),s=new Array(r),a=new Array(r);for(n=0;n<r;++n)o=Zt(e[n]),i[n]=o.r||0,s[n]=o.g||0,a[n]=o.b||0;return i=t(i),s=t(s),a=t(a),o.opacity=1,function(t){return o.r=i(t),o.g=s(t),o.b=a(t),o+""}}}ue(function(t){var e=t.length-1;return function(n){var o=n<=0?n=0:n>=1?(n=1,e-1):Math.floor(n*e),r=t[o],i=t[o+1];return se((n-o/e)*e,o>0?t[o-1]:2*r-i,r,i,o<e-1?t[o+2]:2*i-r)}}),ue(function(t){var e=t.length;return function(n){var o=Math.floor(((n%=1)<0?++n:n)*e);return se((n-o/e)*e,t[(o+e-1)%e],t[o%e],t[(o+1)%e],t[(o+2)%e])}});var le,de,fe=function(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}},pe=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,me=new RegExp(pe.source,"g"),ge=function(t,e){var n,o,r,i=pe.lastIndex=me.lastIndex=0,s=-1,a=[],c=[];for(t+="",e+="";(n=pe.exec(t))&&(o=me.exec(e));)(r=o.index)>i&&(r=e.slice(i,r),a[s]?a[s]+=r:a[++s]=r),(n=n[0])===(o=o[0])?a[s]?a[s]+=o:a[++s]=o:(a[++s]=null,c.push({i:s,x:fe(n,o)})),i=me.lastIndex;return i<e.length&&(r=e.slice(i),a[s]?a[s]+=r:a[++s]=r),a.length<2?c[0]?function(t){return function(e){return t(e)+""}}(c[0].x):function(t){return function(){return t}}(e):(e=c.length,function(t){for(var n,o=0;o<e;++o)a[(n=c[o]).i]=n.x(t);return a.join("")})},ye=function(t,e){if(t=function(t){let e;for(;e=t.sourceEvent;)t=e;return t}(t),void 0===e&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var o=n.createSVGPoint();return o.x=t.clientX,o.y=t.clientY,[(o=o.matrixTransform(e.getScreenCTM().inverse())).x,o.y]}if(e.getBoundingClientRect){var r=e.getBoundingClientRect();return[t.clientX-r.left-e.clientLeft,t.clientY-r.top-e.clientTop]}}return[t.pageX,t.pageY]},ve=0,we=0,be=0,_e=0,xe=0,Ne=0,ke="object"==typeof performance&&performance.now?performance:Date,ze="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Te(){return xe||(ze(Me),xe=ke.now()+Ne)}function Me(){xe=0}function Oe(){this._call=this._time=this._next=null}function Ae(t,e,n){var o=new Oe;return o.restart(t,e,n),o}function Se(){xe=(_e=ke.now())+Ne,ve=we=0;try{!function(){Te(),++ve;for(var t,e=le;e;)(t=xe-e._time)>=0&&e._call.call(null,t),e=e._next;--ve}()}finally{ve=0,function(){for(var t,e,n=le,o=1/0;n;)n._call?(o>n._time&&(o=n._time),t=n,n=n._next):(e=n._next,n._next=null,n=t?t._next=e:le=e);de=t,Pe(o)}(),xe=0}}function Ee(){var t=ke.now(),e=t-_e;e>1e3&&(Ne-=e,_e=t)}function Pe(t){ve||(we&&(we=clearTimeout(we)),t-xe>24?(t<1/0&&(we=setTimeout(Se,t-ke.now()-Ne)),be&&(be=clearInterval(be))):(be||(_e=ke.now(),be=setInterval(Ee,1e3)),ve=1,ze(Se)))}Oe.prototype=Ae.prototype={constructor:Oe,restart:function(t,e,n){if("function"!=typeof t)throw new TypeError("callback is not a function");n=(null==n?Te():+n)+(null==e?0:+e),this._next||de===this||(de?de._next=this:le=this,de=this),this._call=t,this._time=n,Pe()},stop:function(){this._call&&(this._call=null,this._time=1/0,Pe())}};var Ce=function(t,e,n){var o=new Oe;return o.restart(n=>{o.stop(),t(n+e)},e=null==e?0:+e,n),o},Re=h("start","end","cancel","interrupt"),De=[],je=function(t,e,n,o,r,i){var s=t.__transition;if(s){if(n in s)return}else t.__transition={};!function(t,e,n){var o,r=t.__transition;function i(c){var h,u,l,d;if(1!==n.state)return a();for(h in r)if((d=r[h]).name===n.name){if(3===d.state)return Ce(i);4===d.state?(d.state=6,d.timer.stop(),d.on.call("interrupt",t,t.__data__,d.index,d.group),delete r[h]):+h<e&&(d.state=6,d.timer.stop(),d.on.call("cancel",t,t.__data__,d.index,d.group),delete r[h])}if(Ce(function(){3===n.state&&(n.state=4,n.timer.restart(s,n.delay,n.time),s(c))}),n.state=2,n.on.call("start",t,t.__data__,n.index,n.group),2===n.state){for(n.state=3,o=new Array(l=n.tween.length),h=0,u=-1;h<l;++h)(d=n.tween[h].value.call(t,t.__data__,n.index,n.group))&&(o[++u]=d);o.length=u+1}}function s(e){for(var r=e<n.duration?n.ease.call(null,e/n.duration):(n.timer.restart(a),n.state=5,1),i=-1,s=o.length;++i<s;)o[i].call(t,r);5===n.state&&(n.on.call("end",t,t.__data__,n.index,n.group),a())}function a(){for(var o in n.state=6,n.timer.stop(),delete r[e],r)return;delete t.__transition}r[e]=n,n.timer=Ae(function(t){n.state=1,n.timer.restart(i,n.delay,n.time),n.delay<=t&&i(t-n.delay)},0,n.time)}(t,n,{name:e,index:o,group:r,on:Re,tween:De,time:i.time,delay:i.delay,duration:i.duration,ease:i.ease,timer:null,state:0})};function Ie(t,e){var n=Le(t,e);if(n.state>0)throw new Error("too late; already scheduled");return n}function Be(t,e){var n=Le(t,e);if(n.state>3)throw new Error("too late; already running");return n}function Le(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}var qe,Xe=function(t,e){var n,o,r,i=t.__transition,s=!0;if(i){for(r in e=null==e?null:e+"",i)(n=i[r]).name===e?(o=n.state>2&&n.state<5,n.state=6,n.timer.stop(),n.on.call(o?"interrupt":"cancel",t,t.__data__,n.index,n.group),delete i[r]):s=!1;s&&delete t.__transition}},He=180/Math.PI,Ye={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1},Fe=function(t,e,n,o,r,i){var s,a,c;return(s=Math.sqrt(t*t+e*e))&&(t/=s,e/=s),(c=t*n+e*o)&&(n-=t*c,o-=e*c),(a=Math.sqrt(n*n+o*o))&&(n/=a,o/=a,c/=a),t*o<e*n&&(t=-t,e=-e,c=-c,s=-s),{translateX:r,translateY:i,rotate:Math.atan2(e,t)*He,skewX:Math.atan(c)*He,scaleX:s,scaleY:a}};function Ue(t,e,n,o){function r(t){return t.length?t.pop()+" ":""}return function(i,s){var a=[],c=[];return i=t(i),s=t(s),function(t,o,r,i,s,a){if(t!==r||o!==i){var c=s.push("translate(",null,e,null,n);a.push({i:c-4,x:fe(t,r)},{i:c-2,x:fe(o,i)})}else(r||i)&&s.push("translate("+r+e+i+n)}(i.translateX,i.translateY,s.translateX,s.translateY,a,c),function(t,e,n,i){t!==e?(t-e>180?e+=360:e-t>180&&(t+=360),i.push({i:n.push(r(n)+"rotate(",null,o)-2,x:fe(t,e)})):e&&n.push(r(n)+"rotate("+e+o)}(i.rotate,s.rotate,a,c),function(t,e,n,i){t!==e?i.push({i:n.push(r(n)+"skewX(",null,o)-2,x:fe(t,e)}):e&&n.push(r(n)+"skewX("+e+o)}(i.skewX,s.skewX,a,c),function(t,e,n,o,i,s){if(t!==n||e!==o){var a=i.push(r(i)+"scale(",null,",",null,")");s.push({i:a-4,x:fe(t,n)},{i:a-2,x:fe(e,o)})}else 1===n&&1===o||i.push(r(i)+"scale("+n+","+o+")")}(i.scaleX,i.scaleY,s.scaleX,s.scaleY,a,c),i=s=null,function(t){for(var e,n=-1,o=c.length;++n<o;)a[(e=c[n]).i]=e.x(t);return a.join("")}}}var Ve=Ue(function(t){const e=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?Ye:Fe(e.a,e.b,e.c,e.d,e.e,e.f)},"px, ","px)","deg)"),We=Ue(function(t){return null==t?Ye:(qe||(qe=document.createElementNS("http://www.w3.org/2000/svg","g")),qe.setAttribute("transform",t),(t=qe.transform.baseVal.consolidate())?Fe((t=t.matrix).a,t.b,t.c,t.d,t.e,t.f):Ye)},", ",")",")");function Ke(t,e){var n,o;return function(){var r=Be(this,t),i=r.tween;if(i!==n)for(var s=0,a=(o=n=i).length;s<a;++s)if(o[s].name===e){(o=o.slice()).splice(s,1);break}r.tween=o}}function Je(t,e,n){var o,r;if("function"!=typeof n)throw new Error;return function(){var i=Be(this,t),s=i.tween;if(s!==o){r=(o=s).slice();for(var a={name:e,value:n},c=0,h=r.length;c<h;++c)if(r[c].name===e){r[c]=a;break}c===h&&r.push(a)}i.tween=r}}function $e(t,e,n){var o=t._id;return t.each(function(){var t=Be(this,o);(t.value||(t.value={}))[e]=n.apply(this,arguments)}),function(t){return Le(t,o).value[e]}}var Ze=function(t,e){var n;return("number"==typeof e?fe:e instanceof Wt?he:(n=Wt(e))?(e=n,he):ge)(t,e)};function Ge(t){return function(){this.removeAttribute(t)}}function Qe(t){return function(){this.removeAttributeNS(t.space,t.local)}}function tn(t,e,n){var o,r,i=n+"";return function(){var s=this.getAttribute(t);return s===i?null:s===o?r:r=e(o=s,n)}}function en(t,e,n){var o,r,i=n+"";return function(){var s=this.getAttributeNS(t.space,t.local);return s===i?null:s===o?r:r=e(o=s,n)}}function nn(t,e,n){var o,r,i;return function(){var s,a,c=n(this);if(null!=c)return(s=this.getAttribute(t))===(a=c+"")?null:s===o&&a===r?i:(r=a,i=e(o=s,c));this.removeAttribute(t)}}function on(t,e,n){var o,r,i;return function(){var s,a,c=n(this);if(null!=c)return(s=this.getAttributeNS(t.space,t.local))===(a=c+"")?null:s===o&&a===r?i:(r=a,i=e(o=s,c));this.removeAttributeNS(t.space,t.local)}}function rn(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function sn(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function an(t,e){var n,o;function r(){var r=e.apply(this,arguments);return r!==o&&(n=(o=r)&&sn(t,r)),n}return r._value=e,r}function cn(t,e){var n,o;function r(){var r=e.apply(this,arguments);return r!==o&&(n=(o=r)&&rn(t,r)),n}return r._value=e,r}function hn(t,e){return function(){Ie(this,t).delay=+e.apply(this,arguments)}}function un(t,e){return e=+e,function(){Ie(this,t).delay=e}}function ln(t,e){return function(){Be(this,t).duration=+e.apply(this,arguments)}}function dn(t,e){return e=+e,function(){Be(this,t).duration=e}}function fn(t,e){if("function"!=typeof e)throw new Error;return function(){Be(this,t).ease=e}}function pn(t,e,n){var o,r,i=function(t){return(t+"").trim().split(/^|\s+/).every(function(t){var e=t.indexOf(".");return e>=0&&(t=t.slice(0,e)),!t||"start"===t})}(e)?Ie:Be;return function(){var s=i(this,t),a=s.on;a!==o&&(r=(o=a).copy()).on(e,n),s.on=r}}var mn=Nt.prototype.constructor;function gn(t){return function(){this.style.removeProperty(t)}}function yn(t,e,n){return function(o){this.style.setProperty(t,e.call(this,o),n)}}function vn(t,e,n){var o,r;function i(){var i=e.apply(this,arguments);return i!==r&&(o=(r=i)&&yn(t,i,n)),o}return i._value=e,i}function wn(t){return function(e){this.textContent=t.call(this,e)}}function bn(t){var e,n;function o(){var o=t.apply(this,arguments);return o!==n&&(e=(n=o)&&wn(o)),e}return o._value=t,o}var _n=0;function xn(t,e,n,o){this._groups=t,this._parents=e,this._name=n,this._id=o}function Nn(){return++_n}var kn=Nt.prototype;xn.prototype=(function(t){return Nt().transition(t)}).prototype={constructor:xn,select:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=l(t));for(var o=this._groups,r=o.length,i=new Array(r),s=0;s<r;++s)for(var a,c,h=o[s],u=h.length,d=i[s]=new Array(u),f=0;f<u;++f)(a=h[f])&&(c=t.call(a,a.__data__,f,h))&&("__data__"in a&&(c.__data__=a.__data__),d[f]=c,je(d[f],e,n,f,d,Le(a,n)));return new xn(i,this._parents,e,n)},selectAll:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=p(t));for(var o=this._groups,r=o.length,i=[],s=[],a=0;a<r;++a)for(var c,h=o[a],u=h.length,l=0;l<u;++l)if(c=h[l]){for(var d,f=t.call(c,c.__data__,l,h),m=Le(c,n),g=0,y=f.length;g<y;++g)(d=f[g])&&je(d,e,n,g,f,m);i.push(f),s.push(c)}return new xn(i,s,e,n)},filter:function(t){"function"!=typeof t&&(t=m(t));for(var e=this._groups,n=e.length,o=new Array(n),r=0;r<n;++r)for(var i,s=e[r],a=s.length,c=o[r]=[],h=0;h<a;++h)(i=s[h])&&t.call(i,i.__data__,h,s)&&c.push(i);return new xn(o,this._parents,this._name,this._id)},merge:function(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,o=e.length,r=Math.min(o,n.length),i=new Array(o),s=0;s<r;++s)for(var a,c=e[s],h=n[s],u=c.length,l=i[s]=new Array(u),d=0;d<u;++d)(a=c[d]||h[d])&&(l[d]=a);for(;s<o;++s)i[s]=e[s];return new xn(i,this._parents,this._name,this._id)},selection:function(){return new mn(this._groups,this._parents)},transition:function(){for(var t=this._name,e=this._id,n=Nn(),o=this._groups,r=o.length,i=0;i<r;++i)for(var s,a=o[i],c=a.length,h=0;h<c;++h)if(s=a[h]){var u=Le(s,e);je(s,t,n,h,a,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new xn(o,this._parents,t,n)},call:kn.call,nodes:kn.nodes,node:kn.node,size:kn.size,empty:kn.empty,each:kn.each,on:function(t,e){var n=this._id;return arguments.length<2?Le(this.node(),n).on.on(t):this.each(pn(n,t,e))},attr:function(t,e){var n=S(t),o="transform"===n?We:Ze;return this.attrTween(t,"function"==typeof e?(n.local?on:nn)(n,o,$e(this,"attr."+t,e)):null==e?(n.local?Qe:Ge)(n):(n.local?en:tn)(n,o,e))},attrTween:function(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==e)return this.tween(n,null);if("function"!=typeof e)throw new Error;var o=S(t);return this.tween(n,(o.local?an:cn)(o,e))},style:function(t,e,n){var o="transform"==(t+="")?Ve:Ze;return null==e?this.styleTween(t,function(t,e){var n,o,r;return function(){var i=X(this,t),s=(this.style.removeProperty(t),X(this,t));return i===s?null:i===n&&s===o?r:r=e(n=i,o=s)}}(t,o)).on("end.style."+t,gn(t)):"function"==typeof e?this.styleTween(t,function(t,e,n){var o,r,i;return function(){var s=X(this,t),a=n(this),c=a+"";return null==a&&(this.style.removeProperty(t),c=a=X(this,t)),s===c?null:s===o&&c===r?i:(r=c,i=e(o=s,a))}}(t,o,$e(this,"style."+t,e))).each(function(t,e){var n,o,r,i,s="style."+e,a="end."+s;return function(){var c=Be(this,t),h=c.on,u=null==c.value[s]?i||(i=gn(e)):void 0;h===n&&r===u||(o=(n=h).copy()).on(a,r=u),c.on=o}}(this._id,t)):this.styleTween(t,function(t,e,n){var o,r,i=n+"";return function(){var s=X(this,t);return s===i?null:s===o?r:r=e(o=s,n)}}(t,o,e),n).on("end.style."+t,null)},styleTween:function(t,e,n){var o="style."+(t+="");if(arguments.length<2)return(o=this.tween(o))&&o._value;if(null==e)return this.tween(o,null);if("function"!=typeof e)throw new Error;return this.tween(o,vn(t,e,null==n?"":n))},text:function(t){return this.tween("text","function"==typeof t?function(t){return function(){var e=t(this);this.textContent=null==e?"":e}}($e(this,"text",t)):function(t){return function(){this.textContent=t}}(null==t?"":t+""))},textTween:function(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(null==t)return this.tween(e,null);if("function"!=typeof t)throw new Error;return this.tween(e,bn(t))},remove:function(){return this.on("end.remove",(t=this._id,function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}));var t},tween:function(t,e){var n=this._id;if(t+="",arguments.length<2){for(var o,r=Le(this.node(),n).tween,i=0,s=r.length;i<s;++i)if((o=r[i]).name===t)return o.value;return null}return this.each((null==e?Ke:Je)(n,t,e))},delay:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?hn:un)(e,t)):Le(this.node(),e).delay},duration:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?ln:dn)(e,t)):Le(this.node(),e).duration},ease:function(t){var e=this._id;return arguments.length?this.each(fn(e,t)):Le(this.node(),e).ease},easeVarying:function(t){if("function"!=typeof t)throw new Error;return this.each(function(t,e){return function(){var n=e.apply(this,arguments);if("function"!=typeof n)throw new Error;Be(this,t).ease=n}}(this._id,t))},end:function(){var t,e,n=this,o=n._id,r=n.size();return new Promise(function(i,s){var a={value:s},c={value:function(){0==--r&&i()}};n.each(function(){var n=Be(this,o),r=n.on;r!==t&&((e=(t=r).copy())._.cancel.push(a),e._.interrupt.push(a),e._.end.push(c)),n.on=e}),0===r&&i()})},[Symbol.iterator]:kn[Symbol.iterator]};var zn={time:null,delay:0,duration:250,ease:function(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}};function Tn(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}function Mn(t){return{type:t}}Nt.prototype.interrupt=function(t){return this.each(function(){Xe(this,t)})},Nt.prototype.transition=function(t){var e,n;t instanceof xn?(e=t._id,t=t._name):(e=Nn(),(n=zn).time=Te(),t=null==t?null:t+"");for(var o=this._groups,r=o.length,i=0;i<r;++i)for(var s,a=o[i],c=a.length,h=0;h<c;++h)(s=a[h])&&je(s,t,e,h,a,n||Tn(s,e));return new xn(o,this._parents,t,e)},Math,["w","e"].map(Mn),["n","s"].map(Mn),["n","w","e","s","nw","ne","sw","se"].map(Mn);var On=t=>()=>t;function An(t,{sourceEvent:e,subject:n,target:o,identifier:r,active:i,x:s,y:a,dx:c,dy:h,dispatch:u}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:o,enumerable:!0,configurable:!0},identifier:{value:r,enumerable:!0,configurable:!0},active:{value:i,enumerable:!0,configurable:!0},x:{value:s,enumerable:!0,configurable:!0},y:{value:a,enumerable:!0,configurable:!0},dx:{value:c,enumerable:!0,configurable:!0},dy:{value:h,enumerable:!0,configurable:!0},_:{value:u}})}function Sn(t){return!t.ctrlKey&&!t.button}function En(){return this.parentNode}function Pn(t,e){return null==e?{x:t.x,y:t.y}:e}function Cn(){return navigator.maxTouchPoints||"ontouchstart"in this}An.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};const Rn=Math.PI,Dn=2*Rn,jn=1e-6,In=Dn-jn;function Bn(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function Ln(){return new Bn}Bn.prototype=Ln.prototype={constructor:Bn,moveTo:function(t,e){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)},closePath:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(t,e){this._+="L"+(this._x1=+t)+","+(this._y1=+e)},quadraticCurveTo:function(t,e,n,o){this._+="Q"+ +t+","+ +e+","+(this._x1=+n)+","+(this._y1=+o)},bezierCurveTo:function(t,e,n,o,r,i){this._+="C"+ +t+","+ +e+","+ +n+","+ +o+","+(this._x1=+r)+","+(this._y1=+i)},arcTo:function(t,e,n,o,r){var i=this._x1,s=this._y1,a=(n=+n)-(t=+t),c=(o=+o)-(e=+e),h=i-t,u=s-e,l=h*h+u*u;if((r=+r)<0)throw new Error("negative radius: "+r);if(null===this._x1)this._+="M"+(this._x1=t)+","+(this._y1=e);else if(l>jn)if(Math.abs(u*a-c*h)>jn&&r){var d=n-i,f=o-s,p=a*a+c*c,m=d*d+f*f,g=Math.sqrt(p),y=Math.sqrt(l),v=r*Math.tan((Rn-Math.acos((p+l-m)/(2*g*y)))/2),w=v/y,b=v/g;Math.abs(w-1)>jn&&(this._+="L"+(t+w*h)+","+(e+w*u)),this._+="A"+r+","+r+",0,0,"+ +(u*d>h*f)+","+(this._x1=t+b*a)+","+(this._y1=e+b*c)}else this._+="L"+(this._x1=t)+","+(this._y1=e)},arc:function(t,e,n,o,r,i){t=+t,e=+e,i=!!i;var s=(n=+n)*Math.cos(o),a=n*Math.sin(o),c=t+s,h=e+a,u=1^i,l=i?o-r:r-o;if(n<0)throw new Error("negative radius: "+n);null===this._x1?this._+="M"+c+","+h:(Math.abs(this._x1-c)>jn||Math.abs(this._y1-h)>jn)&&(this._+="L"+c+","+h),n&&(l<0&&(l=l%Dn+Dn),l>In?this._+="A"+n+","+n+",0,1,"+u+","+(t-s)+","+(e-a)+"A"+n+","+n+",0,1,"+u+","+(this._x1=c)+","+(this._y1=h):l>jn&&(this._+="A"+n+","+n+",0,"+ +(l>=Rn)+","+u+","+(this._x1=t+n*Math.cos(r))+","+(this._y1=e+n*Math.sin(r))))},rect:function(t,e,n,o){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)+"h"+ +n+"v"+ +o+"h"+-n+"Z"},toString:function(){return this._}};var qn=Ln,Xn=function t(e){function n(t,n){return t=null==t?0:+t,n=null==n?1:+n,1===arguments.length?(n=t,t=0):n-=t,function(){return e()*n+t}}return n.source=t,n}(Math.random),Hn=function(t){return"string"==typeof t?new _t([document.querySelectorAll(t)],[document.documentElement]):new _t([null==t?[]:d(t)],bt)};function Yn(t){return((t=Math.exp(t))+1/t)/2}var Fn=function t(e,n,o){function r(t,r){var i,s,a=t[0],c=t[1],h=t[2],u=r[2],l=r[0]-a,d=r[1]-c,f=l*l+d*d;if(f<1e-12)s=Math.log(u/h)/e,i=function(t){return[a+t*l,c+t*d,h*Math.exp(e*t*s)]};else{var p=Math.sqrt(f),m=(u*u-h*h+o*f)/(2*h*n*p),g=(u*u-h*h-o*f)/(2*u*n*p),y=Math.log(Math.sqrt(m*m+1)-m),v=Math.log(Math.sqrt(g*g+1)-g);s=(v-y)/e,i=function(t){var o,r=t*s,i=Yn(y),u=h/(n*p)*(i*(o=e*r+y,((o=Math.exp(2*o))-1)/(o+1))-function(t){return((t=Math.exp(t))-1/t)/2}(y));return[a+u*l,c+u*d,h*i/Yn(e*r+y)]}}return i.duration=1e3*s*e/Math.SQRT2,i}return r.rho=function(e){var n=Math.max(.001,+e),o=n*n;return t(n,o,o*o)},r}(Math.SQRT2,2,4),Un=t=>()=>t;function Vn(t,{sourceEvent:e,target:n,transform:o,dispatch:r}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:o,enumerable:!0,configurable:!0},_:{value:r}})}function Wn(t,e,n){this.k=t,this.x=e,this.y=n}Wn.prototype={constructor:Wn,scale:function(t){return 1===t?this:new Wn(this.k*t,this.x,this.y)},translate:function(t,e){return 0===t&0===e?this:new Wn(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Kn=new Wn(1,0,0);function Jn(t){for(;!t.__zoom;)if(!(t=t.parentNode))return Kn;return t.__zoom}function $n(t){t.stopImmediatePropagation()}Jn.prototype=Wn.prototype;var Zn=function(t){t.preventDefault(),t.stopImmediatePropagation()};function Gn(t){return!(t.ctrlKey&&"wheel"!==t.type||t.button)}function Qn(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t).hasAttribute("viewBox")?[[(t=t.viewBox.baseVal).x,t.y],[t.x+t.width,t.y+t.height]]:[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]:[[0,0],[t.clientWidth,t.clientHeight]]}function to(){return this.__zoom||Kn}function eo(t){return-t.deltaY*(1===t.deltaMode?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function no(){return navigator.maxTouchPoints||"ontouchstart"in this}function oo(t,e,n){var o=t.invertX(e[0][0])-n[0][0],r=t.invertX(e[1][0])-n[1][0],i=t.invertY(e[0][1])-n[0][1],s=t.invertY(e[1][1])-n[1][1];return t.translate(r>o?(o+r)/2:Math.min(0,o)||Math.max(0,r),s>i?(i+s)/2:Math.min(0,i)||Math.max(0,s))}class ro{static error(t,e){switch(e){case"eval":throw new EvalError(t);case"range":throw new RangeError(t);case"reference":throw new ReferenceError(t);case"syntax":throw new SyntaxError(t);case"type":throw new TypeError(t);case"uri":throw new URIError(t);default:throw new Error(t)}}static info(t){console.log(t)}static debug(t){console.debug(t)}}class io{static cloneObject(t){return null===t?null:"object"==typeof t?JSON.parse(JSON.stringify(t)):void ro.error("Impossible to clone a non-object","type")}static clearObject(t){for(const e in t)delete t[e]}static fromObjectToArray(t){const e=[];for(const n in t)e.push(t[n]);return e}static mergeObjects(t,e,n=!1){if(void 0===e&&this.isPureObjectType(t))return this.cloneObject(t);if(void 0===t&&this.isPureObjectType(e))return this.cloneObject(e);this.isPureObjectType(t)&&this.isPureObjectType(e)||ro.error("Only two pure objects can be merged","type");const o=this.cloneObject(t);for(const r in e){const t=e[r];n&&void 0===o[r]||(this.isPrimitiveType(t)||null===t?o[r]=t:Array.isArray(t)?o[r]=io.cloneObject(t):this.isPureObjectType(t)?o[r]=this.isPureObjectType(o[r])?io.mergeObjects(o[r],t):io.cloneObject(t):ro.error(`Type "${typeof t}" not allowed here`,"type"))}return o}static cssRules(t){let e="",n=document.styleSheets;for(let o=0;o<n.length;o++){const r=n[o].cssRules;if(r)for(let n=0;n<r.length;n++){const o=r[n],i=o.cssText.match(/^@font-face/);(t.querySelector(o.selectorText)||i)&&(e+=o.cssText)}}return e}static isPrimitiveType(t){return"string"==typeof t||"number"==typeof t||"boolean"==typeof t||void 0===t}static isPureObjectType(t){return"object"==typeof t&&!Array.isArray(t)&&null!==t}static removeAllRanges(){window.getSelection().removeAllRanges()}static focusWithCaretAtEnd(t){const e=document.createRange(),n=window.getSelection();t.focus(),e.selectNodeContents(t),e.collapse(!1),n.removeAllRanges(),n.addRange(e)}}class so{constructor(){const t=io.fromObjectToArray(ao);this.dispatcher=h(...t)}call(t,...e){return this.dispatcher.call(t,...e)}on(t,e){"string"!=typeof t&&ro.error("The event must be a string","type"),ao[t]||ro.error("The event does not exist"),this.dispatcher.on(ao[t],e)}}var ao=function(t){return t.create="mindap-create",t.center="mindap-center",t.undo="mindap-undo",t.redo="mindap-redo",t.exportJSON="mindap-export-json",t.exportImage="mindap-export-image",t.zoomIn="mindap-zoom-in",t.zoomOut="mindap-zoom-out",t.nodeSelect="mindap-node-select",t.nodeDeselect="mindap-node-deselect",t.nodeUpdate="mindap-node-update",t.nodeCreate="mindap-node-create",t.nodeRemove="mindap-node-remove",t.nodePayloadSelect="mindap-node-payload-select",t}({});class co{constructor(t){this.zoomIn=t=>{t&&"number"!=typeof t&&ro.error("The parameter must be a number","type"),this.move(!0,t),this.map.events.call(ao.zoomIn)},this.zoomOut=t=>{t&&"number"!=typeof t&&ro.error("The parameter must be a number","type"),this.move(!1,t),this.map.events.call(ao.zoomOut)},this.center=(t,e=500)=>{t&&"zoom"!==t&&"position"!==t&&ro.error('The type must be a string ("zoom" or "position")',"type"),e&&"number"!=typeof e&&ro.error("The duration must be a number","type");const n=this.map.nodes.getRoot(),o=this.map.dom.container.node().clientWidth,r=this.map.dom.container.node().clientHeight,i=o/2-n.coordinates.x,s=r/2-n.coordinates.y,a=this.map.dom.svg.transition().duration(e);switch(t){case"zoom":this.zoomBehavior.scaleTo(a,1);break;case"position":this.zoomBehavior.translateTo(a,o/2-i,r/2-s);break;default:this.zoomBehavior.transform(a,Kn.translate(i,s))}this.map.events.call(ao.center)},this.map=t,this.zoomBehavior=function(){var t,e,n,o=Gn,r=Qn,i=oo,s=eo,a=no,c=[0,1/0],u=[[-1/0,-1/0],[1/0,1/0]],l=250,d=Fn,f=h("start","zoom","end"),p=500,m=0,g=10;function y(t){t.property("__zoom",to).on("wheel.zoom",k).on("mousedown.zoom",z).on("dblclick.zoom",T).filter(a).on("touchstart.zoom",M).on("touchmove.zoom",O).on("touchend.zoom touchcancel.zoom",A).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function v(t,e){return(e=Math.max(c[0],Math.min(c[1],e)))===t.k?t:new Wn(e,t.x,t.y)}function w(t,e,n){var o=e[0]-n[0]*t.k,r=e[1]-n[1]*t.k;return o===t.x&&r===t.y?t:new Wn(t.k,o,r)}function b(t){return[(+t[0][0]+ +t[1][0])/2,(+t[0][1]+ +t[1][1])/2]}function _(t,e,n,o){t.on("start.zoom",function(){x(this,arguments).event(o).start()}).on("interrupt.zoom end.zoom",function(){x(this,arguments).event(o).end()}).tween("zoom",function(){var t=this,i=arguments,s=x(t,i).event(o),a=r.apply(t,i),c=null==n?b(a):"function"==typeof n?n.apply(t,i):n,h=Math.max(a[1][0]-a[0][0],a[1][1]-a[0][1]),u=t.__zoom,l="function"==typeof e?e.apply(t,i):e,f=d(u.invert(c).concat(h/u.k),l.invert(c).concat(h/l.k));return function(t){if(1===t)t=l;else{var e=f(t),n=h/e[2];t=new Wn(n,c[0]-e[0]*n,c[1]-e[1]*n)}s.zoom(null,t)}})}function x(t,e,n){return!n&&t.__zooming||new N(t,e)}function N(t,e){this.that=t,this.args=e,this.active=0,this.sourceEvent=null,this.extent=r.apply(t,e),this.taps=0}function k(t,...e){if(o.apply(this,arguments)){var n=x(this,e).event(t),r=this.__zoom,a=Math.max(c[0],Math.min(c[1],r.k*Math.pow(2,s.apply(this,arguments)))),h=ye(t);if(n.wheel)n.mouse[0][0]===h[0]&&n.mouse[0][1]===h[1]||(n.mouse[1]=r.invert(n.mouse[0]=h)),clearTimeout(n.wheel);else{if(r.k===a)return;n.mouse=[h,r.invert(h)],Xe(this),n.start()}Zn(t),n.wheel=setTimeout(l,150),n.zoom("mouse",i(w(v(r,a),n.mouse[0],n.mouse[1]),n.extent,u))}function l(){n.wheel=null,n.end()}}function z(t,...e){if(!n&&o.apply(this,arguments)){var r=x(this,e,!0).event(t),s=kt(t.view).on("mousemove.zoom",d,!0).on("mouseup.zoom",f,!0),a=ye(t,c),c=t.currentTarget,h=t.clientX,l=t.clientY;Mt(t.view),$n(t),r.mouse=[a,this.__zoom.invert(a)],Xe(this),r.start()}function d(t){if(Zn(t),!r.moved){var e=t.clientX-h,n=t.clientY-l;r.moved=e*e+n*n>m}r.event(t).zoom("mouse",i(w(r.that.__zoom,r.mouse[0]=ye(t,c),r.mouse[1]),r.extent,u))}function f(t){s.on("mousemove.zoom mouseup.zoom",null),Ot(t.view,r.moved),Zn(t),r.event(t).end()}}function T(t,...e){if(o.apply(this,arguments)){var n=this.__zoom,s=ye(t.changedTouches?t.changedTouches[0]:t,this),a=n.invert(s),c=i(w(v(n,n.k*(t.shiftKey?.5:2)),s,a),r.apply(this,e),u);Zn(t),l>0?kt(this).transition().duration(l).call(_,c,s,t):kt(this).call(y.transform,c,s,t)}}function M(n,...r){if(o.apply(this,arguments)){var i,s,a,c,h=n.touches,u=h.length,l=x(this,r,n.changedTouches.length===u).event(n);for($n(n),s=0;s<u;++s)c=[c=ye(a=h[s],this),this.__zoom.invert(c),a.identifier],l.touch0?l.touch1||l.touch0[2]===c[2]||(l.touch1=c,l.taps=0):(l.touch0=c,i=!0,l.taps=1+!!t);t&&(t=clearTimeout(t)),i&&(l.taps<2&&(e=c[0],t=setTimeout(function(){t=null},p)),Xe(this),l.start())}}function O(t,...e){if(this.__zooming){var n,o,r,s,a=x(this,e).event(t),c=t.changedTouches,h=c.length;for(Zn(t),n=0;n<h;++n)r=ye(o=c[n],this),a.touch0&&a.touch0[2]===o.identifier?a.touch0[0]=r:a.touch1&&a.touch1[2]===o.identifier&&(a.touch1[0]=r);if(o=a.that.__zoom,a.touch1){var l=a.touch0[0],d=a.touch0[1],f=a.touch1[0],p=a.touch1[1],m=(m=f[0]-l[0])*m+(m=f[1]-l[1])*m,g=(g=p[0]-d[0])*g+(g=p[1]-d[1])*g;o=v(o,Math.sqrt(m/g)),r=[(l[0]+f[0])/2,(l[1]+f[1])/2],s=[(d[0]+p[0])/2,(d[1]+p[1])/2]}else{if(!a.touch0)return;r=a.touch0[0],s=a.touch0[1]}a.zoom("touch",i(w(o,r,s),a.extent,u))}}function A(t,...o){if(this.__zooming){var r,i,s=x(this,o).event(t),a=t.changedTouches,c=a.length;for($n(t),n&&clearTimeout(n),n=setTimeout(function(){n=null},p),r=0;r<c;++r)i=a[r],s.touch0&&s.touch0[2]===i.identifier?delete s.touch0:s.touch1&&s.touch1[2]===i.identifier&&delete s.touch1;if(s.touch1&&!s.touch0&&(s.touch0=s.touch1,delete s.touch1),s.touch0)s.touch0[1]=this.__zoom.invert(s.touch0[0]);else if(s.end(),2===s.taps&&(i=ye(i,this),Math.hypot(e[0]-i[0],e[1]-i[1])<g)){var h=kt(this).on("dblclick.zoom");h&&h.apply(this,arguments)}}}return y.transform=function(t,e,n,o){var r=t.selection?t.selection():t;r.property("__zoom",to),t!==r?_(t,e,n,o):r.interrupt().each(function(){x(this,arguments).event(o).start().zoom(null,"function"==typeof e?e.apply(this,arguments):e).end()})},y.scaleBy=function(t,e,n,o){y.scaleTo(t,function(){return this.__zoom.k*("function"==typeof e?e.apply(this,arguments):e)},n,o)},y.scaleTo=function(t,e,n,o){y.transform(t,function(){var t=r.apply(this,arguments),o=this.__zoom,s=null==n?b(t):"function"==typeof n?n.apply(this,arguments):n,a=o.invert(s),c="function"==typeof e?e.apply(this,arguments):e;return i(w(v(o,c),s,a),t,u)},n,o)},y.translateBy=function(t,e,n,o){y.transform(t,function(){return i(this.__zoom.translate("function"==typeof e?e.apply(this,arguments):e,"function"==typeof n?n.apply(this,arguments):n),r.apply(this,arguments),u)},null,o)},y.translateTo=function(t,e,n,o,s){y.transform(t,function(){var t=r.apply(this,arguments),s=this.__zoom,a=null==o?b(t):"function"==typeof o?o.apply(this,arguments):o;return i(Kn.translate(a[0],a[1]).scale(s.k).translate("function"==typeof e?-e.apply(this,arguments):-e,"function"==typeof n?-n.apply(this,arguments):-n),t,u)},o,s)},N.prototype={event:function(t){return t&&(this.sourceEvent=t),this},start:function(){return 1==++this.active&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(t,e){return this.mouse&&"mouse"!==t&&(this.mouse[1]=e.invert(this.mouse[0])),this.touch0&&"touch"!==t&&(this.touch0[1]=e.invert(this.touch0[0])),this.touch1&&"touch"!==t&&(this.touch1[1]=e.invert(this.touch1[0])),this.that.__zoom=e,this.emit("zoom"),this},end:function(){return 0==--this.active&&(delete this.that.__zooming,this.emit("end")),this},emit:function(t){var e=kt(this.that).datum();f.call(t,this.that,new Vn(t,{sourceEvent:this.sourceEvent,target:y,type:t,transform:this.that.__zoom,dispatch:f}),e)}},y.wheelDelta=function(t){return arguments.length?(s="function"==typeof t?t:Un(+t),y):s},y.filter=function(t){return arguments.length?(o="function"==typeof t?t:Un(!!t),y):o},y.touchable=function(t){return arguments.length?(a="function"==typeof t?t:Un(!!t),y):a},y.extent=function(t){return arguments.length?(r="function"==typeof t?t:Un([[+t[0][0],+t[0][1]],[+t[1][0],+t[1][1]]]),y):r},y.scaleExtent=function(t){return arguments.length?(c[0]=+t[0],c[1]=+t[1],y):[c[0],c[1]]},y.translateExtent=function(t){return arguments.length?(u[0][0]=+t[0][0],u[1][0]=+t[1][0],u[0][1]=+t[0][1],u[1][1]=+t[1][1],y):[[u[0][0],u[0][1]],[u[1][0],u[1][1]]]},y.constrain=function(t){return arguments.length?(i=t,y):i},y.duration=function(t){return arguments.length?(l=+t,y):l},y.interpolate=function(t){return arguments.length?(d=t,y):d},y.on=function(){var t=f.on.apply(f,arguments);return t===f?y:t},y.clickDistance=function(t){return arguments.length?(m=(t=+t)*t,y):Math.sqrt(m)},y.tapDistance=function(t){return arguments.length?(g=+t,y):g},y}().scaleExtent([.5,2]).on("zoom",t=>{this.map.dom.g.attr("transform",t.transform)})}getZoomBehavior(){return this.zoomBehavior}move(t,e=50){const n=this.map.dom.svg.transition().duration(e);this.zoomBehavior.scaleBy(n,t?4/3:3/4)}}class ho{constructor(t){this.map=t}create(){this.map.dom.container=kt("#"+this.map.id).style("position","relative"),this.map.dom.svg=this.map.dom.container.append("svg").style("position","absolute").style("width","100%").style("height","100%").style("top",0).style("left",0),this.map.dom.svg.append("rect").attr("width","100%").attr("height","100%").attr("fill","white").attr("pointer-events","all").on("click",()=>{this.map.nodes.deselectNode()}),this.map.dom.g=this.map.dom.svg.append("g")}update(){const t=this.map.nodes.getNodes(),e={nodes:this.map.dom.g.selectAll("."+this.map.id+"_node").data(t),branches:this.map.dom.g.selectAll("."+this.map.id+"_branch").data(t.slice(1))};let n=!1;const o=e.nodes.enter().append("g").style("cursor","pointer").attr("class",this.map.id+"_node").attr("id",function(t){return t.dom=this,t.id}).attr("transform",t=>"translate("+t.coordinates.x+","+t.coordinates.y+")").on("dblclick",(t,e)=>{this.enableNodeNameEditing(e)}).on("touchstart",(t,e)=>{if(!n)return n=!0,setTimeout(function(){n=!1},300),!1;this.enableNodeNameEditing(e)});!0===this.map.options.drag?o.call(this.map.drag.getDragBehavior()):o.on("mousedown",(t,e)=>{this.map.nodes.selectNode(e.id)}),o.insert("foreignObject").html(t=>this.createNodeNameDOM(t)).each(t=>{this.updateNodeNameContainer(t)}),o.insert("path","foreignObject").style("fill",t=>t.colors.background).style("stroke-width",1).attr("d",t=>this.drawNodeBackground(t)),o.each(t=>{this.setImage(t),this.setPayloadFlag(t)}),e.branches.enter().insert("path","g").style("fill","none").style("stroke",t=>t.colors.branch).attr("class",this.map.id+"_branch").attr("id",t=>t.id+"_branch").attr("d",t=>this.drawBranch(t)),e.nodes.exit().remove(),e.branches.exit().remove()}clear(){Hn("."+this.map.id+"_node, ."+this.map.id+"_branch").remove()}drawNodeBackground(t){const e=t.getNameDOM(),n=qn();t.dimensions.width=e.clientWidth+45,t.dimensions.height=e.clientHeight+30;const o=t.dimensions.width/2,r=t.dimensions.height/2;return n.moveTo(-o,0),n.arcTo(-o,-r,4-o,-r,4),n.arcTo(o,-r,o,4-r,4),n.arcTo(o,r,o-4,r,4),n.arcTo(-o,r,-o,r-4,4),n.closePath(),n}drawBranch(t){const e=t.parent,n=qn(),o=t.getLevel(),r=22-3*(o<6?o:6),i=(e.coordinates.x+t.coordinates.x)/2,s=(e.coordinates.x>t.coordinates.x?-1:1)*(e.coordinates.y<t.coordinates.y+t.dimensions.height/2?-1:1);return n.moveTo(e.coordinates.x,e.coordinates.y),n.bezierCurveTo(i-r*s,e.coordinates.y-r/2,e.coordinates.x-r/2*s,t.coordinates.y+t.dimensions.height/2-r/3,t.coordinates.x,t.coordinates.y),n}updateNodeShapes(t){const e=t.getBackgroundDOM();kt(e).attr("d",t=>this.drawNodeBackground(t)),Hn("."+this.map.id+"_branch").attr("d",t=>this.drawBranch(t)),this.updateImagePosition(t),this.updateNodeNameContainer(t)}setImage(t){let e=t.getImageDOM();if(e||(e=document.createElementNS("http://www.w3.org/2000/svg","image"),t.dom.appendChild(e)),""!==t.image.src){const n=new Image;n.src=t.image.src,n.onload=function(){const n=t.image.size,o=this.width*n/this.height,r=-(n+t.dimensions.height/2+5),i=-o/2;e.setAttribute("href",t.image.src),e.setAttribute("height",n.toString()),e.setAttribute("width",o.toString()),e.setAttribute("y",r.toString()),e.setAttribute("x",i.toString())},n.onerror=function(){e.remove(),t.image.src=""}}else e.remove()}setPayloadFlag(t){if(!t.payload)return;const{width:e,height:n}=t.dimensions,o=-e/2+4+4,r=n/2-4-4;kt(t.dom).append("circle").style("fill","darkseagreen").attr("cx",o).attr("cy",r).attr("r",4).on("click",()=>{this.map.events.call(ao.nodePayloadSelect,t.payload)})}updateImagePosition(t){if(""!==t.image.src){const e=t.getImageDOM(),n=-(e.getBBox().height+t.dimensions.height/2+5);e.setAttribute("y",n.toString())}}enableNodeNameEditing(t){if(this.map.options.readonly)return;const e=t.getNameDOM();io.focusWithCaretAtEnd(e),e.style.setProperty("cursor","auto"),e.ondblclick=e.onmousedown=t=>{t.stopPropagation()},e.oninput=()=>{this.updateNodeShapes(t)},e.onkeydown=t=>{if("Escape"===t.code&&(io.removeAllRanges(),e.blur()),t.ctrlKey||t.metaKey)switch(t.code){case"KeyA":case"KeyC":case"KeyV":case"KeyX":case"KeyZ":case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":case"Backspace":case"Delete":return!0;default:return!1}switch(t.code){case"Tab":return!1;default:return!0}},e.onpaste=t=>{t.preventDefault();const e=t.clipboardData.getData("text/plain");document.execCommand("insertHTML",!1,e)},e.onblur=()=>{e.innerHTML="<br>"===e.innerHTML?"":e.innerHTML,e.innerHTML!==t.name&&this.map.nodes.updateNode("name",e.innerHTML),e.ondblclick=e.onmousedown=e.onblur=e.onkeydown=e.oninput=e.onpaste=null,e.style.setProperty("cursor","pointer"),e.blur()}}updateNodeNameContainer(t){const e=t.getNameDOM(),n=e.parentNode;0!==e.offsetWidth&&(n.setAttribute("x",(-e.clientWidth/2).toString()),n.setAttribute("y",(-e.clientHeight/2).toString()),n.setAttribute("width",e.clientWidth.toString()),n.setAttribute("height",e.clientHeight.toString()))}createNodeNameDOM(t){const e=document.createElement("div");return e.style.setProperty("font-size",t.font.size.toString()+"px"),e.style.setProperty("color",t.colors.name),e.style.setProperty("font-style",t.font.style),e.style.setProperty("font-weight",t.font.weight),e.style.setProperty("text-decoration",t.font.decoration),e.style.setProperty("display","inline-block"),e.style.setProperty("white-space","pre"),e.style.setProperty("font-family",this.map.options.fontFamily),e.style.setProperty("text-align","center"),this.map.options.readonly||e.setAttribute("contenteditable","true"),e.innerHTML=t.name,e.outerHTML}}class uo{constructor(t={},e){var n,o,r;this._readonly=!1,this.drag=!0,this.zoom=!0,this._map=e,this.fontFamily=t.fontFamily||"Arial, Helvetica, sans-serif",this.centerOnResize=void 0===t.centerOnResize||t.centerOnResize,this.drag=null===(n=t.drag)||void 0===n||n,this.zoom=null===(o=t.zoom)||void 0===o||o,this.readonly=null!==(r=t.readonly)&&void 0!==r&&r,this.defaultNode=io.mergeObjects({name:"Node",image:{src:"",size:60},colors:{name:"#787878",background:"#f9f9f9",branch:"#577a96"},font:{size:16,style:"normal",weight:"normal"},locked:!0},t.defaultNode,!0),this.rootNode=io.mergeObjects({name:"Root node",image:{src:"",size:70},colors:{name:"#787878",background:"aliceblue",branch:""},font:{size:20,style:"normal",weight:"normal"}},t.rootNode,!0)}set readonly(t){this._readonly=t,this._readonly&&(this.drag=!1)}get readonly(){return this._readonly}update(t,e){switch("string"!=typeof t&&ro.error("The property must be a string","type"),t){case"fontFamily":this.updateFontFamily(e);break;case"centerOnResize":this.updateCenterOnResize(e);break;case"drag":this.updateDrag(e);break;case"zoom":this.updateZoom(e);break;case"defaultNode":this.updateDefaultNode(e);break;case"rootNode":this.updateDefaultRootNode(e);break;default:ro.error("The property does not exist")}}updateFontFamily(t){"string"!=typeof t&&ro.error("The font must be a string","type"),this.fontFamily=t,this._map.draw.update()}updateCenterOnResize(t){"boolean"!=typeof t&&ro.error("The value must be a boolean","type"),this.centerOnResize=t,!0===this.centerOnResize?kt(window).on("resize."+this._map.id,()=>{this._map.zoom.center()}):kt(window).on("resize."+this._map.id,null)}updateDrag(t){"boolean"!=typeof t&&ro.error("The value must be a boolean","type"),this.drag=t,this._map.draw.clear(),this._map.draw.update()}updateZoom(t){"boolean"!=typeof t&&ro.error("The value must be a boolean","type"),this.zoom=t,!0===this.zoom?this._map.dom.svg.call(this._map.zoom.getZoomBehavior()):this._map.dom.svg.on(".zoom",null)}updateDefaultNode(t){this.defaultNode=io.mergeObjects(this.defaultNode,t,!0)}updateDefaultRootNode(t){this.rootNode=io.mergeObjects(this.rootNode,t,!0)}}class lo{constructor(t){this.id=t.id,this.parent=t.parent,this.name=t.name,this.coordinates=t.coordinates,this.colors=t.colors,this.image=t.image,this.font=t.font,this.locked=t.locked,this.payload=t.payload,this.dimensions={width:0,height:0},this.k=t.k||Xn(-20,20)()}isRoot(){const t=this.id.split("_");return"0"===t[t.length-1]}getLevel(){let t=1,e=this.parent;for(;e;)t++,e=e.parent;return t}getNameDOM(){return this.dom.querySelector("foreignObject > div")}getBackgroundDOM(){return this.dom.querySelector("path")}getImageDOM(){return this.dom.querySelector("image")}}class fo{constructor(t){this.current=()=>this.snapshots[this.index],this.map=t,this.index=-1,this.snapshots=[]}new(t){if(void 0===t){const t=io.cloneObject(this.map.nodes.getRoot().coordinates);this.map.nodes.setCounter(0),this.map.nodes.clear(),this.map.draw.clear(),this.map.draw.update(),this.map.nodes.addRootNode(t),this.map.zoom.center(null,0),this.save(),this.map.events.call(ao.create)}else this.checkSnapshotStructure(t)?(this.redraw(t),this.map.zoom.center("position",0),this.save(),this.map.events.call(ao.create),console.log(this.map)):ro.error("The snapshot is not correct")}undo(){this.index>0&&(this.redraw(this.snapshots[--this.index]),this.map.events.call(ao.undo))}redo(){this.index<this.snapshots.length-1&&(this.redraw(this.snapshots[++this.index]),this.map.events.call(ao.redo))}save(){this.index<this.snapshots.length-1&&this.snapshots.splice(this.index+1),this.snapshots.push(this.getSnapshot()),this.index++}getHistory(){return{snapshots:this.snapshots.slice(0),index:this.index}}redraw(t){this.map.nodes.clear(),t.forEach(t=>{const e={id:this.sanitizeNodeId(t.id),parent:this.map.nodes.getNode(this.sanitizeNodeId(t.parent)),k:t.k,name:t.name,coordinates:io.cloneObject(t.coordinates),image:io.cloneObject(t.image),colors:io.cloneObject(t.colors),font:io.cloneObject(t.font),locked:t.locked};t.payload&&(e.payload=io.cloneObject(t.payload));const n=new lo(e);this.map.nodes.setNode(n.id,n)}),this.map.draw.clear(),this.map.draw.update(),this.map.nodes.selectRootNode(),this.setCounter()}getSnapshot(){return this.map.nodes.getNodes().map(t=>this.map.nodes.getNodeProperties(t,!1)).slice()}setCounter(){const t=this.map.nodes.getNodes().map(t=>{const e=t.id.split("_");return parseInt(e[e.length-1])});this.map.nodes.setCounter(Math.max(...t)+1)}sanitizeNodeId(t){if("string"==typeof t){const e=t.split("_");return this.map.id+"_"+e[e.length-2]+"_"+e[e.length-1]}}checkSnapshotStructure(t){if(!Array.isArray(t))return!1;t[0].key&&t[0].value&&this.convertOldMmp(t);for(const e of t)if(!this.checkNodeProperties(e))return!1;return this.translateNodePositions(t),!0}checkNodeProperties(t){return["string"==typeof t.id,"string"==typeof t.parent,"number"==typeof t.k,"string"==typeof t.name,"boolean"==typeof t.locked,t.coordinates&&"number"==typeof t.coordinates.x&&"number"==typeof t.coordinates.y,t.image&&"number"==typeof t.image.size&&"string"==typeof t.image.src,t.colors&&"string"==typeof t.colors.background&&"string"==typeof t.colors.branch&&"string"==typeof t.colors.name,t.font&&"number"==typeof t.font.size&&"string"==typeof t.font.weight&&"string"==typeof t.font.style].every(t=>t)}convertOldMmp(t){for(const e of t){const t=io.cloneObject(e);io.clearObject(e),e.id="map_node_"+t.key.substr(4),e.parent=t.value.parent?"map_node_"+t.value.parent.substr(4):"",e.k=t.value.k,e.name=t.value.name,e.locked=t.value.fixed,e.coordinates={x:t.value.x,y:t.value.y},e.image={size:parseInt(t.value["image-size"]),src:t.value["image-src"]},e.colors={background:t.value["background-color"],branch:t.value["branch-color"]||"",name:t.value["text-color"]},e.font={size:parseInt(t.value["font-size"]),weight:t.value.bold?"bold":"normal",style:t.value.italic?"italic":"normal"}}}translateNodePositions(t){const e=this.map.nodes.getRoot(),n=t.find(t=>{const e=t.id.split("_");return"0"===e[e.length-1]}),o=n.coordinates.x-e.coordinates.x,r=n.coordinates.y-e.coordinates.y;for(const i of t)i.coordinates.x-=o,i.coordinates.y-=r}}class po{constructor(t){this.map=t,t.options.readonly||(this.dragBehavior=function(){var t,e,n,o,r=Sn,i=En,s=Pn,a=Cn,c={},u=h("start","drag","end"),l=0,d=0;function f(t){t.on("mousedown.drag",p).filter(a).on("touchstart.drag",y).on("touchmove.drag",v).on("touchend.drag touchcancel.drag",w).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function p(s,a){if(!o&&r.call(this,s,a)){var c=b(this,i.call(this,s,a),s,a,"mouse");c&&(kt(s.view).on("mousemove.drag",m,!0).on("mouseup.drag",g,!0),Mt(s.view),zt(s),n=!1,t=s.clientX,e=s.clientY,c("start",s))}}function m(o){if(Tt(o),!n){var r=o.clientX-t,i=o.clientY-e;n=r*r+i*i>d}c.mouse("drag",o)}function g(t){kt(t.view).on("mousemove.drag mouseup.drag",null),Ot(t.view,n),Tt(t),c.mouse("end",t)}function y(t,e){if(r.call(this,t,e)){var n,o,s=t.changedTouches,a=i.call(this,t,e),c=s.length;for(n=0;n<c;++n)(o=b(this,a,t,e,s[n].identifier,s[n]))&&(zt(t),o("start",t,s[n]))}}function v(t){var e,n,o=t.changedTouches,r=o.length;for(e=0;e<r;++e)(n=c[o[e].identifier])&&(Tt(t),n("drag",t,o[e]))}function w(t){var e,n,r=t.changedTouches,i=r.length;for(o&&clearTimeout(o),o=setTimeout(function(){o=null},500),e=0;e<i;++e)(n=c[r[e].identifier])&&(zt(t),n("end",t,r[e]))}function b(t,e,n,o,r,i){var a,h,d,p=u.copy(),m=ye(i||n,e);if(null!=(d=s.call(t,new An("beforestart",{sourceEvent:n,target:f,identifier:r,active:l,x:m[0],y:m[1],dx:0,dy:0,dispatch:p}),o)))return a=d.x-m[0]||0,h=d.y-m[1]||0,function n(i,s,u){var g,y=m;switch(i){case"start":c[r]=n,g=l++;break;case"end":delete c[r],--l;case"drag":m=ye(u||s,e),g=l}p.call(i,t,new An(i,{sourceEvent:s,subject:d,target:f,identifier:r,active:g,x:m[0]+a,y:m[1]+h,dx:m[0]-y[0],dy:m[1]-y[1],dispatch:p}),o)}}return f.filter=function(t){return arguments.length?(r="function"==typeof t?t:On(!!t),f):r},f.container=function(t){return arguments.length?(i="function"==typeof t?t:On(t),f):i},f.subject=function(t){return arguments.length?(s="function"==typeof t?t:On(t),f):s},f.touchable=function(t){return arguments.length?(a="function"==typeof t?t:On(!!t),f):a},f.on=function(){var t=u.on.apply(u,arguments);return t===u?f:t},f.clickDistance=function(t){return arguments.length?(d=(t=+t)*t,f):Math.sqrt(d)},f}().on("start",(t,e)=>this.started(e,t)).on("drag",(t,e)=>this.dragged(e,t)).on("end",(t,e)=>this.ended(e)))}getDragBehavior(){return this.dragBehavior}started(t,e){e.sourceEvent.preventDefault(),this.orientation=this.map.nodes.getOrientation(t),this.descendants=this.map.nodes.getDescendants(t),this.map.nodes.selectNode(t.id)}dragged(t,e){const n=e.dy,o=e.dx,r=t.coordinates.x+=o,i=t.coordinates.y+=n;if(t.dom.setAttribute("transform","translate("+[r,i]+")"),t.locked){const e=this.map.nodes.getOrientation(t),r=e!==this.orientation,i=t;for(const t of this.descendants){let e=t.coordinates.x+=o,s=t.coordinates.y+=n;r&&(e=t.coordinates.x+=2*(i.coordinates.x-t.coordinates.x)),t.dom.setAttribute("transform","translate("+[e,s]+")")}r&&(this.orientation=e)}Hn("."+this.map.id+"_branch").attr("d",t=>this.map.draw.drawBranch(t)),this.dragging=!0}ended(t){this.dragging&&(this.dragging=!1,this.map.history.save(),this.map.events.call(ao.nodeUpdate,t.dom,this.map.nodes.getNodeProperties(t)))}}class mo{constructor(t){this.updateNodeName=(t,e,n=!1)=>{if(e&&"string"!=typeof e&&ro.error("The name must be a string","type"),t.name==e&&!n)return!1;t.getNameDOM().innerHTML=e,this.map.draw.updateNodeShapes(t),!1===n&&(t.name=e)},this.updateNodeCoordinates=(t,e)=>{const n=this.fixCoordinates(e);if((e=io.mergeObjects(t.coordinates,n,!0)).x===t.coordinates.x&&e.y===t.coordinates.y)return!1;{const n=this.getOrientation(this.selectedNode),o=t.coordinates.x-e.x,r=t.coordinates.y-e.y;if(t.coordinates=io.cloneObject(e),t.dom.setAttribute("transform","translate("+[e.x,e.y]+")"),this.selectedNode.locked){const t=this.selectedNode,e=this.getDescendants(this.selectedNode),i=this.getOrientation(this.selectedNode);for(const s of e){let e=s.coordinates.x-=o,a=s.coordinates.y-=r;n!==i&&(e=s.coordinates.x+=2*(t.coordinates.x-s.coordinates.x)),s.dom.setAttribute("transform","translate("+[e,a]+")")}}Hn("."+this.map.id+"_branch").attr("d",t=>this.map.draw.drawBranch(t))}},this.updateNodeBackgroundColor=(t,e,n=!1)=>{if(e&&"string"!=typeof e&&ro.error("The background color must be a string","type"),t.colors.background===e&&!n)return!1;{const o=t.getBackgroundDOM();o.style.fill=e,""!==o.style.stroke&&(o.style.stroke=Wt(e).darker(.5).toString()),!1===n&&(t.colors.background=e)}},this.updateNodeNameColor=(t,e,n=!1)=>{if(e&&"string"!=typeof e&&ro.error("The text color must be a string","type"),t.colors.name===e&&!n)return!1;t.getNameDOM().style.color=e,!1===n&&(t.colors.name=e)},this.updateNodeBranchColor=(t,e,n=!1)=>{if(e&&"string"!=typeof e&&ro.error("The branch color must be a string","type"),t.isRoot())ro.error("The root node has no branches");else{if(t.colors.name===e&&!n)return!1;{const o=document.getElementById(t.id+"_branch");o.style.fill=o.style.stroke=e,!1===n&&(t.colors.branch=e)}}},this.updateNodeFontSize=(t,e,n=!1)=>{if(e&&"number"!=typeof e&&ro.error("The font size must be a number","type"),t.font.size==e&&!n)return!1;t.getNameDOM().style["font-size"]=e+"px",this.map.draw.updateNodeShapes(t),!1===n&&(t.font.size=e)},this.updateNodeImageSize=(t,e,n=!1)=>{if(e&&"number"!=typeof e&&ro.error("The image size must be a number","type"),""!==t.image.src){if(t.image.size===e&&!n)return!1;{const o=t.getImageDOM(),r=o.getBBox(),i=e,s=r.width*i/r.height,a=-(i+t.dimensions.height/2+5),c=-s/2;o.setAttribute("height",i.toString()),o.setAttribute("width",s.toString()),o.setAttribute("y",a.toString()),o.setAttribute("x",c.toString()),!1===n&&(t.image.size=i)}}else ro.error("The node does not have an image")},this.updateNodeImageSrc=(t,e)=>{if(e&&"string"!=typeof e&&ro.error("The image path must be a string","type"),t.image.src===e)return!1;t.image.src=e,this.map.draw.setImage(t)},this.updateNodeFontStyle=(t,e,n=!1)=>{if(e&&"string"!=typeof e&&ro.error("The font style must be a string","type"),t.font.style===e)return!1;t.getNameDOM().style["font-style"]=e,!1===n&&(t.font.style=e)},this.updateNodeFontWeight=(t,e,n=!1)=>{if(e&&"string"!=typeof e&&ro.error("The font weight must be a string","type"),t.font.weight===e)return!1;t.getNameDOM().style["font-weight"]=e,this.map.draw.updateNodeShapes(t),!1===n&&(t.font.weight=e)},this.updateNodeTextDecoration=(t,e,n=!1)=>{if(e&&"string"!=typeof e&&ro.error("The text decoration must be a string","type"),t.font.decoration===e)return!1;t.getNameDOM().style["text-decoration"]=e,this.map.draw.updateNodeShapes(t),!1===n&&(t.font.decoration=e)},this.updateNodeLockedStatus=(t,e)=>{e&&"boolean"!=typeof e&&ro.error("The node locked status must be a boolean","type"),t.isRoot()?ro.error("The root node can not be locked"):t.locked=e||!t.locked},this.map=t,this.counter=0,this.nodes=new Map}addRootNode(t){const e=io.mergeObjects(this.map.options.rootNode,{coordinates:{x:this.map.dom.container.node().clientWidth/2,y:this.map.dom.container.node().clientHeight/2},locked:!1,id:this.map.id+"_node_"+this.counter,parent:null}),n=new lo(e);t&&(n.coordinates.x=t.x||n.coordinates.x,n.coordinates.y=t.y||n.coordinates.y),this.nodes.set(e.id,n),this.counter++,this.map.draw.update(),this.selectRootNode()}addNode(t,e){e&&"string"!=typeof e&&ro.error("The node id must be a string","type");const n=e?this.getNode(e):this.selectedNode;void 0===n&&ro.error('There are no nodes with id "'+e+'"');const o=io.mergeObjects(this.map.options.defaultNode,t,!0);o.id=this.map.id+"_node_"+this.counter,o.parent=n;const r=new lo(o);if(this.nodes.set(o.id,r),this.counter++,r.coordinates=this.calculateCoordinates(r),t&&t.coordinates){const e=this.fixCoordinates(t.coordinates);r.coordinates=io.mergeObjects(r.coordinates,e,!0)}this.map.draw.update(),this.map.history.save(),this.map.events.call(ao.nodeCreate,r.dom,this.getNodeProperties(r))}selectNode(t){if(void 0!==t&&("string"!=typeof t&&ro.error("The node id must be a string","type"),!this.nodeSelectionTo(t)))if(this.nodes.has(t)){const e=this.nodes.get(t),n=e.getBackgroundDOM();if(!n.style.stroke){this.selectedNode&&(this.selectedNode.getBackgroundDOM().style.stroke="");const t=Wt(n.style.fill).darker(.5);n.style.stroke=t.toString(),io.removeAllRanges(),this.selectedNode.getNameDOM().blur(),this.selectedNode=e,this.map.events.call(ao.nodeSelect,e.dom,this.getNodeProperties(e))}}else ro.error("The node id or the direction is not correct");return this.getNodeProperties(this.selectedNode)}editNode(){this.selectedNode&&this.map.draw.enableNodeNameEditing(this.selectedNode)}deselectNode(){this.selectedNode&&(this.selectedNode.getBackgroundDOM().style.stroke="",io.removeAllRanges()),this.selectRootNode(),this.map.events.call(ao.nodeDeselect)}updateNode(t,e,n=!1,o){let r;switch(o&&"string"!=typeof o&&ro.error("The node id must be a string","type"),void 0===(o?this.getNode(o):this.selectedNode)&&ro.error('There are no nodes with id "'+o+'"'),"string"!=typeof t&&ro.error("The property must be a string","type"),t){case"name":r=this.updateNodeName(this.selectedNode,e,n);break;case"locked":r=this.updateNodeLockedStatus(this.selectedNode,e);break;case"coordinates":r=this.updateNodeCoordinates(this.selectedNode,e);break;case"imageSrc":r=this.updateNodeImageSrc(this.selectedNode,e);break;case"imageSize":r=this.updateNodeImageSize(this.selectedNode,e,n);break;case"backgroundColor":r=this.updateNodeBackgroundColor(this.selectedNode,e,n);break;case"branchColor":r=this.updateNodeBranchColor(this.selectedNode,e,n);break;case"fontWeight":r=this.updateNodeFontWeight(this.selectedNode,e,n);break;case"textDecoration":r=this.updateNodeTextDecoration(this.selectedNode,e,n);break;case"fontStyle":r=this.updateNodeFontStyle(this.selectedNode,e,n);break;case"fontSize":r=this.updateNodeFontSize(this.selectedNode,e,n);break;case"nameColor":r=this.updateNodeNameColor(this.selectedNode,e,n);break;default:ro.error("The property does not exist")}!1===n&&!1!==r&&(this.map.history.save(),this.map.events.call(ao.nodeUpdate,this.selectedNode.dom,this.getNodeProperties(this.selectedNode)))}removeNode(t){t&&"string"!=typeof t&&ro.error("The node id must be a string","type");const e=t?this.getNode(t):this.selectedNode;void 0===e&&ro.error('There are no nodes with id "'+t+'"'),e.isRoot()?ro.error("The root node can not be deleted"):(this.nodes.delete(e.id),this.getDescendants(e).forEach(t=>{this.nodes.delete(t.id)}),this.map.draw.clear(),this.map.draw.update(),this.map.history.save(),this.map.events.call(ao.nodeRemove,null,this.getNodeProperties(e)),this.deselectNode())}nodeChildren(t){t&&"string"!=typeof t&&ro.error("The node id must be a string","type");const e=t?this.getNode(t):this.selectedNode;return void 0===e&&ro.error('There are no nodes with id "'+t+'"'),Array.from(this.nodes.values()).filter(t=>t.parent&&t.parent.id===e.id).map(t=>this.getNodeProperties(t))}getNodeProperties(t,e=!0){return{id:t.id,parent:t.parent?t.parent.id:"",name:t.name,coordinates:e?this.fixCoordinates(t.coordinates,!0):io.cloneObject(t.coordinates),image:io.cloneObject(t.image),colors:io.cloneObject(t.colors),font:io.cloneObject(t.font),locked:t.locked,k:t.k}}fixCoordinates(t,e=!1){const n=Jn(this.map.dom.svg.node()),o={};return t.x&&(o.x=!1===e?(t.x-n.x)/n.k:t.x*n.k+n.x),t.y&&(o.y=!1===e?(t.y-n.y)/n.k:t.y*n.k+n.y),o}nodeSelectionTo(t){switch(t){case"up":return this.moveSelectionOnLevel(!0),!0;case"down":return this.moveSelectionOnLevel(!1),!0;case"left":return this.moveSelectionOnBranch(!0),!0;case"right":return this.moveSelectionOnBranch(!1),!0;default:return!1}}getChildren(t){return Array.from(this.nodes.values()).filter(e=>e.parent&&e.parent.id===t.id)}getOrientation(t){if(!t.isRoot())return t.coordinates.x<this.getRoot().coordinates.x}getRoot(){return this.nodes.get(this.map.id+"_node_0")}getDescendants(t){let e=[];return this.getChildren(t).forEach(t=>{e.push(t),e=e.concat(this.getDescendants(t))}),e}getNodes(){return Array.from(this.nodes.values())}getNode(t){return this.nodes.get(t)}setNode(t,e){this.nodes.set(t,e)}getCounter(){return this.counter}setCounter(t){this.counter=t}getSelectedNode(){return this.selectedNode}selectRootNode(){this.selectedNode=this.nodes.get(this.map.id+"_node_0")}clear(){this.nodes.clear()}getSiblings(t){if(t.isRoot())return[];{const e=this.getChildren(t.parent);return e.length>1?(e.splice(e.indexOf(t),1),e):[]}}calculateCoordinates(t){let e={x:t.parent.coordinates.x,y:t.parent.coordinates.y},n=this.getSiblings(t);if(t.parent.isRoot()){const t=[],o=[];for(const e of n)this.getOrientation(e)?o.push(e):t.push(e);o.length<=t.length?(e.x-=200,n=o):(e.x+=200,n=t)}else this.getOrientation(t.parent)?e.x-=200:e.x+=200;if(n.length>0){const t=this.getLowerNode(n);e.y=t.coordinates.y+60}else e.y-=120;return e}getLowerNode(t=Array.from(this.nodes.values())){if(t.length>0){let e=t[0].coordinates.y,n=t[0];for(const o of t)o.coordinates.y>e&&(e=o.coordinates.y,n=o);return n}}moveSelectionOnLevel(t){if(!this.selectedNode.isRoot()){let e=this.getSiblings(this.selectedNode).filter(e=>t===e.coordinates.y<this.selectedNode.coordinates.y);if(this.selectedNode.parent.isRoot()&&(e=e.filter(t=>this.getOrientation(t)===this.getOrientation(this.selectedNode))),e.length>0){let t=e[0],n=Math.abs(e[0].coordinates.y-this.selectedNode.coordinates.y);for(const o of e){const e=Math.abs(o.coordinates.y-this.selectedNode.coordinates.y);e<n&&(n=e,t=o)}this.selectNode(t.id)}}}moveSelectionOnBranch(t){if(!1===this.getOrientation(this.selectedNode)&&t||!0===this.getOrientation(this.selectedNode)&&!t)this.selectNode(this.selectedNode.parent.id);else{let e=this.getChildren(this.selectedNode);void 0===this.getOrientation(this.selectedNode)&&(e=e.filter(e=>this.getOrientation(e)===t));const n=this.getLowerNode(e);e.length>0&&this.selectNode(n.id)}}}class go{constructor(t){this.map=t}asJSON(){const t=this.map.history.current();return this.map.events.call(ao.exportJSON),io.cloneObject(t)}asImage(t,e){"function"!=typeof t&&ro.error("The first parameter must be a function","type"),e&&"string"!=typeof e&&ro.error("The second optional parameter must be a string","type"),this.map.nodes.deselectNode(),this.dataURI(n=>{const o=new Image;o.src=n,o.onload=()=>{const n=document.createElement("canvas"),r=n.getContext("2d");n.width=o.width,n.height=o.height,r.drawImage(o,0,0),r.globalCompositeOperation="destination-over",r.fillStyle="#ffffff",r.fillRect(0,0,n.width,n.height),"string"==typeof e&&(e="image/"+e),t(n.toDataURL(e)),this.map.events.call(ao.exportImage)},o.onerror=()=>{ro.error("The image has not been loaded correctly")}})}dataURI(t){const e=this.map.dom.g.node(),n=e.cloneNode(!0),o=document.createElementNS("http://www.w3.org/2000/svg","svg"),r=e.getBBox(),i=io.cssRules(e),s="http://www.w3.org/2000/xmlns/",a=r.x-15,c=r.y-15,h=r.width+30,u=r.height+30;if(o.setAttributeNS(s,"xmlns","http://www.w3.org/2000/svg"),o.setAttributeNS(s,"xmlns:xlink","http://www.w3.org/1999/xlink"),o.setAttribute("version","1.1"),o.setAttribute("width",h),o.setAttribute("height",u),o.setAttribute("viewBox",[a,c,h,u].join(" ")),""!==i){const t=document.createElement("style"),e=document.createElement("defs");t.setAttribute("type","text/css"),t.innerHTML="<![CDATA[\n"+i+"\n]]>",e.appendChild(t),o.appendChild(e)}n.setAttribute("transform","translate(0,0)"),o.appendChild(n),this.convertImages(n,()=>{const e=new XMLSerializer,n=new FileReader,r=new Blob([e.serializeToString(o)],{type:"image/svg+xml"});n.readAsDataURL(r),n.onloadend=()=>{t(n.result)}})}convertImages(t,e){let n=t.querySelectorAll("image"),o=n.length;if(o>0)for(const r of n){const t=document.createElement("canvas"),n=t.getContext("2d"),i=new Image,s=r.getAttribute("href");i.crossOrigin="Anonymous",i.src=s,i.onload=function(){t.width=i.width,t.height=i.height,n.drawImage(i,0,0),r.setAttribute("href",t.toDataURL("image/png")),o--,0===o&&e()},i.onerror=()=>{o--,0===o&&e()}}else e()}}class yo{constructor(t){this.copy=t=>{t&&"string"!=typeof t&&ro.error("The node id must be a string","type");const e=t?this.map.nodes.getNode(t):this.map.nodes.getSelectedNode();void 0===e&&ro.error('There are no nodes with id "'+t+'"'),e.isRoot()?ro.error("The root node can not be copied"):(this.copiedNodes=[this.map.nodes.getNodeProperties(e,!1)],this.map.nodes.getDescendants(e).forEach(t=>{this.copiedNodes.push(this.map.nodes.getNodeProperties(t,!1))}))},this.cut=t=>{t&&"string"!=typeof t&&ro.error("The node id must be a string","type");const e=t?this.map.nodes.getNode(t):this.map.nodes.getSelectedNode();void 0===e&&ro.error('There are no nodes with id "'+t+'"'),e.isRoot()?ro.error("The root node can not be cut"):(this.copiedNodes=[this.map.nodes.getNodeProperties(e,!1)],this.map.nodes.getDescendants(e).forEach(t=>{this.copiedNodes.push(this.map.nodes.getNodeProperties(t,!1))}),this.map.nodes.removeNode(e.id))},this.paste=t=>{void 0===this.copiedNodes&&ro.error("There are not nodes in the mmp clipboard"),t&&"string"!=typeof t&&ro.error("The node id must be a string","type");const e=t?this.map.nodes.getNode(t):this.map.nodes.getSelectedNode();void 0===e&&ro.error('There are no nodes with id "'+t+'"');const n=this.map.nodes.getRoot(),o=(t,e)=>{let r;if(t.id!==this.copiedNodes[0].id){r={x:0,y:0};const o=this.copiedNodes.find(e=>e.id===t.parent);let i=o.coordinates.x-t.coordinates.x;const s=o.coordinates.y-t.coordinates.y,a=this.map.nodes.getOrientation(e);o.coordinates.x<n.coordinates.x!==a&&(i=-i),r.x=e.coordinates.x-i,r.y=e.coordinates.y-s,r=this.map.nodes.fixCoordinates(r,!0)}const i=io.cloneObject(t);this.map.nodes.addNode({name:i.name,coordinates:r,image:i.image,colors:i.colors,font:i.font,locked:i.locked},e.id);const s=this.copiedNodes.filter(e=>e.parent===t.id);if(s.length>0){const t=this.map.nodes.getNodes();e=t[t.length-1],s.forEach(t=>{o(t,e)})}};o(this.copiedNodes[0],e)},this.map=t}}class vo{constructor(t,e){return this.id=t,this.dom={},this.events=new so,this.options=new uo(e,this),this.zoom=new co(this),this.history=new fo(this),this.drag=new po(this),this.draw=new ho(this),this.nodes=new mo(this),this.export=new go(this),this.copyPaste=new yo(this),this.draw.create(),!0===this.options.centerOnResize&&kt(window).on("resize."+this.id,()=>{this.zoom.center()}),!0===this.options.zoom&&this.dom.svg.call(this.zoom.getZoomBehavior()).on("dblclick.zoom",null),this.nodes.addRootNode(),this.history.save(),this.createMindapInstance()}remove(){this.dom.svg.remove();const t=Object.keys(this.instance);for(let e=0;e<t.length;e++)delete this.instance[t[e]]}createMindapInstance(){return this.instance={on:this.events.on.bind(this.events),remove:this.remove.bind(this),new:this.history.new.bind(this.history),updateOptions:this.options.update.bind(this.options),exportAsJSON:this.export.asJSON.bind(this.export),exportAsImage:this.export.asImage.bind(this.export),history:this.history.getHistory.bind(this.history),undo:this.history.undo.bind(this.history),redo:this.history.redo.bind(this.history),zoomIn:this.zoom.zoomIn.bind(this.zoom),zoomOut:this.zoom.zoomOut.bind(this.zoom),center:this.zoom.center.bind(this.zoom),addNode:this.nodes.addNode.bind(this.nodes),selectNode:this.nodes.selectNode.bind(this.nodes),editNode:this.nodes.editNode.bind(this.nodes),deselectNode:this.nodes.deselectNode.bind(this.nodes),nodeChildren:this.nodes.nodeChildren.bind(this.nodes),updateNode:this.nodes.updateNode.bind(this.nodes),removeNode:this.nodes.removeNode.bind(this.nodes),copyNode:this.copyPaste.copy.bind(this.copyPaste),cutNode:this.copyPaste.cut.bind(this.copyPaste),pasteNode:this.copyPaste.paste.bind(this.copyPaste)}}}function wo(t,e){return new vo(t,e)}}}]);